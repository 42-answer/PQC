{% extends "base.html" %}

{% block title %}Signatures Demo - Post-Quantum OIDC{% endblock %}

{% block content %}
<div class="card">
    <h2>‚úçÔ∏è Post-Quantum Digital Signatures</h2>
    <p style="color: #666; margin-bottom: 20px;">
        Test NIST-standardized post-quantum signature algorithms: ML-DSA (Dilithium) and Falcon.
        These algorithms are quantum-resistant and will replace RSA/ECDSA in the post-quantum era.
    </p>
    
    <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0;">
        <label for="sigAlgorithm"><strong>Select Signature Algorithm:</strong></label>
        <select id="sigAlgorithm">
            <option value="ML-DSA-44" selected>ML-DSA-44 (NIST Level 2)</option>
            <option value="ML-DSA-65">ML-DSA-65 (NIST Level 3)</option>
            <option value="ML-DSA-87">ML-DSA-87 (NIST Level 5)</option>
            <option value="Falcon-512">Falcon-512 (NIST Level 1)</option>
            <option value="Falcon-1024">Falcon-1024 (NIST Level 5)</option>
        </select>
        
        <label for="message"><strong>Message to Sign:</strong></label>
        <input type="text" id="message" placeholder="Enter message..." value="Hello, Post-Quantum World!">
        
        <button id="runSignature" onclick="runSignature()">
            <span id="buttonText">Sign & Verify Message</span>
            <span id="buttonLoading" style="display: none;" class="loading"></span>
        </button>
    </div>
    
    <div id="results"></div>
</div>

<div class="card">
    <h3>üìã Signature Process</h3>
    <ol style="line-height: 2; color: #555;">
        <li><strong>Key Generation:</strong> Generate public/private key pair</li>
        <li><strong>Signing:</strong> Create digital signature over message using private key</li>
        <li><strong>Verification:</strong> Verify signature using public key</li>
        <li><strong>Invalid Test:</strong> Confirm that invalid signatures are rejected</li>
    </ol>
</div>
{% endblock %}

{% block scripts %}
<script>
async function runSignature() {
    const algorithm = document.getElementById('sigAlgorithm').value;
    const message = document.getElementById('message').value;
    const button = document.getElementById('runSignature');
    const buttonText = document.getElementById('buttonText');
    const buttonLoading = document.getElementById('buttonLoading');
    const resultsDiv = document.getElementById('results');
    
    button.disabled = true;
    buttonText.style.display = 'none';
    buttonLoading.style.display = 'inline-block';
    
    try {
        const response = await fetch('/api/signatures/test', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({algorithm: algorithm, message: message})
        });
        
        const data = await response.json();
        
        if (data.success) {
            resultsDiv.innerHTML = `
                <div class="result success">
                    <h3 class="success-icon">Signature Verification Successful!</h3>
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin: 20px 0;">
                        <div class="metric">
                            <div class="metric-label">Algorithm</div>
                            <div class="metric-value">${data.algorithm}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Total Time</div>
                            <div class="metric-value">${data.total_time_ms} ms</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Valid Signature</div>
                            <div class="metric-value">${data.is_valid ? '‚úì' : '‚úó'}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Invalid Rejected</div>
                            <div class="metric-value">${data.invalid_rejected ? '‚úì' : '‚úó'}</div>
                        </div>
                    </div>
                    
                    <h4>‚è±Ô∏è Operation Times:</h4>
                    <div class="step">
                        <span class="step-number">1</span>
                        <strong>Key Generation:</strong> ${data.keygen_time_ms} ms
                    </div>
                    <div class="step">
                        <span class="step-number">2</span>
                        <strong>Signing:</strong> ${data.sign_time_ms} ms
                    </div>
                    <div class="step">
                        <span class="step-number">3</span>
                        <strong>Verification:</strong> ${data.verify_time_ms} ms
                    </div>
                    
                    <h4>üì¶ Sizes:</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0;">
                        <div class="metric">
                            <div class="metric-label">Public Key</div>
                            <div class="metric-value">${data.public_key_size} bytes</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Signature</div>
                            <div class="metric-value">${data.signature_size} bytes</div>
                        </div>
                    </div>
                    
                    <p style="margin-top: 20px; padding: 15px; background: #d4edda; border-radius: 8px; color: #155724;">
                        <strong>‚úì ${data.message}</strong>
                    </p>
                </div>
            `;
        } else {
            resultsDiv.innerHTML = `
                <div class="result error">
                    <h3 class="error-icon">Error</h3>
                    <p>${data.error}</p>
                </div>
            `;
        }
    } catch (error) {
        resultsDiv.innerHTML = `
            <div class="result error">
                <h3 class="error-icon">Error</h3>
                <p>${error.message}</p>
            </div>
        `;
    } finally {
        button.disabled = false;
        buttonText.style.display = 'inline';
        buttonLoading.style.display = 'none';
    }
}
</script>
{% endblock %}
